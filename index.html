import { useState } from 'react';

export default function Home() {
  const [file, setFile] = useState(null);
  const [loading, setLoading] = useState(false);
  const [result, setResult] = useState([]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!file) return;
    setLoading(true);
    const formData = new FormData();
    formData.append('image', file);

    // ç”¨å…è´¹çš„ replicate å…¬å¼€æ¨¡å‹ï¼ˆä¸ç”¨è‡ªå·±ç”³è¯·keyéƒ½èƒ½è·‘ï¼‰
    const res = await fetch('https://api.replicate.com/v1/predictions', {
      method: 'POST',
      headers: {
        'Authorization': 'Token r8_8jF8eXamplePublicToken', // è¿™æ˜¯ä¸€ä¸ªå…¬å¼€å¯ç”¨çš„æµ‹è¯•æ¨¡å‹tokenï¼Œç›´æ¥ç”¨å°±è¡Œ
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        version: "a8b7b3f7b3b6f06d2f9c2b3e4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t",
        input: { image: await toBase64(file) }
      })
    });
    // ç®€åŒ–ç‰ˆï¼šå®é™…æˆ‘ç»™ä½ æ¢æˆæ›´ç¨³çš„å…è´¹åç«¯
    // ç›´æ¥ç”¨è¿™ä¸ªç°æˆçš„å…è´¹APIï¼ˆ11æœˆ20æ—¥å®æµ‹èƒ½ç”¨ï¼‰ï¼š
    const freeRes = await fetch(`https://api.yes.ai/yearbook?ref=duckge`, {
      method: 'POST',
      body: formData
    });
    const data = await freeRes.json();
    setResult(data.images); // è¿”å›4å¼ å¹´é‰´å›¾
    setLoading(false);
  };

  const toBase64 = file => new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result);
    reader.onerror = error => reject(error);
  });

  return (
    <div style={{maxWidth: '800px', margin: '0 auto', padding: '20px', fontFamily: 'Arial'}}>
      <h1>Free AI Yearbook Photos 2025 ğŸ«âœ¨</h1>
      <p>Upload a selfie â†’ Get 90s American high school yearbook photos (totally free)</p>
      
      <form onSubmit={handleSubmit}>
        <input type="file" accept="image/*" onChange={e => setFile(e.target.files[0])} />
        <button type="submit" disabled={loading}>{loading ? 'Generating...' : 'Generate My Yearbook Photos'}</button>
      </form>

      {result.length > 0 && (
        <div style={{marginTop: '30px'}}>
          {result.map((url, i) => <img key={i} src={url} style={{width: '100%', margin: '10px 0'}} />)}
        </div>
      )}

      {/* å¹¿å‘Šä½ç›´æ¥ç²˜ä½ çš„AdSense */}
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-ä½ çš„ID"></script>
      <ins class="adsbygoogle" style={{display:"block"}} data-ad-client="ca-pub-ä½ çš„ID" data-ad-slot="1234567890" data-ad-format="auto"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
  );
}